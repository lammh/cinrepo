<?php /*
This File was developed by Stefan Warnat <vtiger@stefanwarnat.de>

It belongs to the Workflow Designer and must not be distrubuted without the complete extension
*/
${"G\x4cO\x42\x41LS"}["\x69h\x6f\x78\x76\x7al\x6ei\x71"]="en\x61b\x6ce\x45\x72r\x6fr";${"G\x4c\x4fB\x41\x4cS"}["\x75j\x6e\x75tvf"]="\x74\x61\x62l\x65\x42\x6c\x6fc\x6b\x73";${"\x47\x4cOB\x41\x4c\x53"}["m\x6fy\x70\x78y\x69\x77"]="wf";${"\x47\x4c\x4f\x42\x41\x4cS"}["t\x67\x72\x72m\x62vg"]="\x68a\x6ed\x6cer\x54y\x70\x65";${"\x47\x4cO\x42ALS"}["q\x77\x76\x6d\x75\x66\x76\x65\x7a"]="\x69\x73\x4ee\x77";${"\x47L\x4f\x42\x41\x4cS"}["\x69as\x67\x6e\x68\x72"]="e\x6e\x76C\x6fm\x6de\x6et";${"\x47\x4c\x4f\x42\x41\x4c\x53"}["z\x6c\x74o\x6ep\x63"]="\x65n\x74i\x74\x79D\x61\x74\x61";${"\x47\x4cO\x42\x41\x4cS"}["\x71\x79\x69r\x77s\x62\x6d\x6d\x75"]="\x77or\x6bfl\x6f\x77\x73";${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x6c\x63\x6e\x69\x7a\x6d"]="\x63o\x6e\x74\x65\x78\x74";${"\x47\x4c\x4f\x42\x41\x4c\x53"}["o\x75b\x6f\x74d"]="\x72e\x63\x6fr\x64\x69\x64";${"\x47\x4c\x4fBAL\x53"}["\x69\x6a\x66\x75\x77\x75pmd\x68"]="ma\x69\x6cdat\x61";${"\x47LO\x42\x41\x4cS"}["\x65\x6cd\x6f\x77m\x72\x61\x75k\x77"]="re\x73\x75l\x74\x5fu";${"\x47\x4cOB\x41L\x53"}["x\x70\x72\x76\x64\x63g\x66"]="\x72e\x73\x75\x6ct_a";${"G\x4c\x4f\x42A\x4c\x53"}["bh\x6d\x66o\x73q\x61\x67d"]="ty\x70e";${"\x47L\x4fB\x41L\x53"}["m\x68\x6e\x6f\x6f\x73v\x64d"]="ema\x69\x6c\x5f\x76al";${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x6a\x6fu\x71\x6d\x77\x63\x74\x6c"]="fro\x6d\x5fe\x6da\x69\x6c";${"G\x4cOB\x41\x4c\x53"}["b\x69ch\x70\x64p\x6fo\x63"]="\x74o_\x65\x6d\x61\x69l";${"\x47L\x4f\x42AL\x53"}["ji\x76\x67rz\x72y\x73\x73\x6f\x72"]="\x70ar\x65\x6et_i\x64\x73";${"\x47\x4c\x4f\x42\x41\x4cS"}["\x75\x6co\x76\x67\x63\x69\x6d"]="\x69s\x41\x6aa\x78";require_once("\x69ncl\x75d\x65/\x75t\x69l\x73/u\x74i\x6cs\x2e\x70\x68p");require_once(realpath(dirname(__FILE__)."/\x61ut\x6flo\x61\x64\x5f\x77f.\x70\x68p"));use Workflow\VTEntity;use Workflow\Main;use Workflow\Queue;use Workflow\EntityDelta;class WfEventHandler extends VTEventHandler{public function handleEvent($handlerType,$entityData){ob_start();$buqkvslhibra="wfM\x61\x6ea\x67\x65r";if(isset($_REQUEST["\x74\x61b\x6c\x65block\x73"])){$fcbnalas="\x74a\x62l\x65\x42\x6c\x6fc\x6b\x73";${$fcbnalas}=$_REQUEST["t\x61blebl\x6fcks"];unset($_REQUEST["\x74\x61b\x6c\x65\x62\x6c\x6f\x63k\x73"]);}${$buqkvslhibra}=new\Workflow\Manager();${"\x47\x4cO\x42\x41LS"}["\x6diok\x64jd\x6d\x64f\x75"]="\x68\x61\x6edl\x65r\x54\x79\x70\x65";EntityDelta::refreshDelta($entityData->getModuleName(),$entityData->focus->id);if(empty($_SERVER["HTT\x50_\x58_RE\x51U\x45\x53\x54ED_\x57I\x54H"])||strtolower($_SERVER["H\x54\x54\x50\x5fX_R\x45Q\x55\x45S\x54\x45D_\x57IT\x48"])!="x\x6d\x6c\x68ttpr\x65\x71\x75e\x73t"){Workflow2::${${"\x47\x4c\x4fB\x41\x4c\x53"}["\x75l\x6f\x76gc\x69\x6d"]}=false;}Workflow2::log($entityData->focus->id,0,0,"St\x61\x72\x74\x20Eve\x6et\x48an\x64le\x72");$snkisgyf="\x74\x61\x62le\x42l\x6f\x63\x6b\x73";if($entityData->getModuleName()=="Ema\x69ls"){${"\x47L\x4fB\x41L\x53"}["wy\x6bg\x6f\x6dk\x6e\x74"]="\x72e\x63ord\x69\x64";$blnoxjqmlwd="\x66\x72\x6f\x6d\x5fe\x6dail";${${"G\x4c\x4f\x42A\x4c\x53"}["ji\x76\x67\x72zry\x73s\x6fr"]}=explode("|",$entityData->get("\x70\x61re\x6et\x5f\x69\x64"));if(!empty($_REQUEST["p\x6do\x64u\x6c\x65"])&&!empty($_REQUEST["\x73\x6f\x72\x63\x65_i\x64\x73"])){$swvglcac="\x70ar\x65\x6e\x74_\x69\x64s";${$swvglcac}[]=$_REQUEST["\x73orc\x65\x5fi\x64\x73"];}$lioxtho="f\x72o\x6d_e\x6da\x69\x6c";${$blnoxjqmlwd}=$entityData->get("f\x72\x6f\x6d_e\x6dail");${${"\x47\x4c\x4fB\x41LS"}["\x62\x69\x63\x68\x70\x64\x70\x6foc"]}=$entityData->get("sa\x76\x65d\x5f\x74\x6f\x69d");if(empty(${${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x6a\x6f\x75\x71m\x77ctl"]})){if(!empty($_REQUEST["fr\x6f\x6d\x5fe\x6da\x69\x6c"])){${"\x47L\x4f\x42\x41L\x53"}["\x72\x62u\x6ap\x72n\x62\x67\x64\x78"]="\x65\x6da\x69l\x5f\x76\x61\x6c";${"\x47LO\x42\x41\x4c\x53"}["\x66\x69\x74\x78\x65f\x66\x62"]="\x74yp\x65";list(${${"\x47L\x4fB\x41\x4c\x53"}["\x66\x69\x74\x78\x65f\x66b"]},${${"G\x4cO\x42A\x4c\x53"}["mhn\x6f\x6f\x73\x76\x64d"]})=explode("::",addslashes($_REQUEST["f\x72\x6fm\x5f\x65m\x61il"]),2);if(${${"\x47L\x4f\x42\x41L\x53"}["r\x62\x75\x6aprn\x62\x67d\x78"]}!=""){global$adb;if(${${"\x47\x4c\x4f\x42\x41\x4c\x53"}["bh\x6d\x66\x6fs\x71a\x67\x64"]}=="\x61"){${"\x47\x4c\x4f\x42\x41L\x53"}["\x66\x71vi\x67\x6et\x72"]="\x73q\x6c\x5f\x61";${"\x47L\x4fB\x41\x4cS"}["j\x6e\x63q\x71\x70l\x6d\x64"]="f\x72\x6f\x6d\x5f\x65\x6da\x69\x6c";$igxjijlcydv="sq\x6c_a";${${"G\x4c\x4f\x42A\x4cS"}["f\x71v\x69\x67\x6e\x74\x72"]}="\x73e\x6c\x65ct *\x20\x66r\x6f\x6d\x20vt\x69\x67\x65\x72\x5fsy\x73\x74em\x73\x20whe\x72\x65 \x66\x72\x6fm_\x65mai\x6c_\x66i\x65l\x64\x20!\x3d ?\x20A\x4eD\x20s\x65\x72v\x65r_\x74\x79\x70e\x20=\x20?";${${"\x47LOBA\x4c\x53"}["\x78p\x72vdcgf"]}=$adb->pquery(${$igxjijlcydv},array("","\x65ma\x69l"));${${"\x47\x4cO\x42\x41LS"}["\x6a\x6e\x63\x71q\x70\x6c\x6d\x64"]}=$adb->query_result(${${"\x47\x4c\x4fB\x41\x4c\x53"}["\x78p\x72\x76\x64\x63\x67\x66"]},0,"\x66r\x6fm_e\x6d\x61\x69l_fi\x65ld");}else{${"G\x4c\x4f\x42\x41\x4cS"}["\x65\x76\x67elu\x7a\x66pjr\x62"]="\x73ql\x5fu";${"\x47L\x4f\x42\x41L\x53"}["\x6a\x62\x68z\x66\x64f\x79"]="\x73\x71\x6c_u";${${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x65\x76\x67elu\x7af\x70j\x72\x62"]}="S\x45\x4c\x45C\x54\x20\x66irst\x5fn\x61\x6d\x65, la\x73t\x5fn\x61\x6de, ".${${"\x47\x4c\x4f\x42A\x4c\x53"}["bh\x6d\x66o\x73\x71\x61g\x64"]}."\x20A\x53\x20e\x6da\x69l \x20F\x52OM v\x74\x69\x67\x65\x72_u\x73ers\x20WH\x45\x52E\x20\x69\x64 \x3d\x20'".${${"G\x4c\x4f\x42A\x4c\x53"}["\x6d\x68\x6e\x6f\x6f\x73\x76\x64\x64"]}."'";${${"GL\x4fB\x41\x4c\x53"}["\x65\x6c\x64o\x77\x6d\x72\x61\x75\x6bw"]}=$adb->pquery(${${"GL\x4f\x42\x41L\x53"}["\x6a\x62\x68\x7af\x64\x66\x79"]},array());${${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x6aou\x71\x6d\x77ct\x6c"]}=$adb->query_result(${${"G\x4c\x4f\x42\x41\x4c\x53"}["\x65l\x64\x6f\x77\x6d\x72\x61\x75\x6b\x77"]},0,"\x65\x6dail");}}}else{$gpvvsxkue="f\x72\x6fm\x5f\x65m\x61\x69l";global$current_user;${$gpvvsxkue}=$current_user->column_fields["e\x6d\x61i\x6c1"];}}${${"\x47\x4c\x4fB\x41\x4cS"}["\x69\x6a\x66u\x77u\x70m\x64h"]}=array("\x73\x75\x62j\x65ct"=>$entityData->get("\x73\x75bjec\x74"),"\x63\x6fn\x74\x65\x6e\x74"=>$entityData->get("\x64e\x73c\x72\x69\x70t\x69\x6f\x6e"),"f\x72\x6f\x6d"=>${$lioxtho},"t\x6f"=>${${"G\x4c\x4f\x42\x41L\x53"}["\x62\x69\x63\x68\x70d\x70\x6f\x6f\x63"]});foreach(${${"G\x4c\x4f\x42\x41\x4c\x53"}["\x6a\x69v\x67\x72\x7a\x72y\x73\x73or"]} as${${"G\x4c\x4fB\x41L\x53"}["\x77y\x6bg\x6f\x6d\x6bn\x74"]}){$ypgvphf="\x72e\x63o\x72\x64\x69\x64";if(empty(${${"\x47L\x4f\x42A\x4c\x53"}["oub\x6ftd"]})){continue;}${${"\x47LO\x42\x41L\x53"}["\x6c\x63\x6e\x69z\x6d"]}=VTEntity::getForId(${$ypgvphf});if(${${"\x47\x4cOBA\x4c\x53"}["l\x63n\x69\x7a\x6d"]}!==false){${"GLO\x42A\x4c\x53"}["\x6c\x78\x74o\x68yl\x6a"]="\x77\x6f\x72\x6b\x66l\x6f\x77\x73";${${"\x47LOBAL\x53"}["\x6cx\x74\x6fh\x79l\x6a"]}=$wfManager->GetWorkflows($context->getModuleName(),Workflow\Main::SENDMAIL_START);if(count(${${"\x47L\x4f\x42\x41\x4c\x53"}["qy\x69\x72\x77\x73b\x6d\x6d\x75"]})>0){${"\x47L\x4f\x42\x41\x4cS"}["\x63\x63\x6e\x6di\x67\x73a\x76\x79"]="mai\x6cd\x61\x74a";$smkkdars="wf";$context->setEnvironment("ema\x69\x6c",${${"G\x4c\x4f\x42A\x4c\x53"}["\x63cn\x6dig\x73a\x76\x79"]});foreach(${${"G\x4c\x4f\x42\x41\x4c\x53"}["qy\x69\x72\x77\x73\x62\x6d\x6d\x75"]} as${$smkkdars}){$wf->setExecutionTrigger("W\x46\x32\x5fC\x52\x45\x41\x54I\x4fN");if(!$context->isAvailable()){break;}$wf->setContext(${${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x6c\x63\x6eiz\x6d"]});if($wf->checkCondition(${${"\x47LO\x42A\x4cS"}["\x7a\x6ct\x6f\x6ep\x63"]})){$wf->start();}}}}}}if($entityData->getModuleName()=="\x4do\x64C\x6fmm\x65n\x74\x73"){${${"\x47LOB\x41\x4cS"}["\x69\x61sg\x6e\x68\x72"]}=array("c\x6fmmen\x74c\x6fntent"=>$entityData->get("c\x6f\x6dm\x65ntconte\x6et"),"a\x73\x73ig\x6ee\x64_u\x73e\x72\x5fid"=>$entityData->get("\x61\x73\x73\x69gned\x5f\x75s\x65\x72\x5f\x69d"));$tvesqluqa="\x70\x61\x72e\x6et\x5f\x69\x64\x73";${$tvesqluqa}=array($entityData->get("\x72elat\x65d\x5fto"));foreach(${${"G\x4c\x4fBA\x4c\x53"}["\x6a\x69v\x67\x72\x7ary\x73\x73\x6f\x72"]} as${${"\x47\x4c\x4fBA\x4c\x53"}["o\x75\x62\x6f\x74d"]}){${${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x6c\x63\x6e\x69\x7am"]}=VTEntity::getForId(${${"G\x4c\x4f\x42\x41L\x53"}["\x6fu\x62\x6f\x74d"]});$context->loadEnvironment(array_merge($context->getEnvironment(),${${"\x47\x4c\x4f\x42AL\x53"}["\x69a\x73\x67\x6e\x68\x72"]}));if(${${"\x47L\x4fBA\x4c\x53"}["lc\x6ei\x7a\x6d"]}!==false){$fpzckemsvm="\x77\x66";${${"\x47L\x4f\x42A\x4cS"}["\x71y\x69\x72\x77\x73\x62\x6dm\x75"]}=$wfManager->GetWorkflows($context->getModuleName(),Workflow\Main::COMMENT_START);foreach(${${"\x47\x4cOBA\x4cS"}["\x71\x79\x69\x72\x77s\x62mm\x75"]} as${$fpzckemsvm}){$wwheuivbjc="cont\x65\x78\x74";$wf->setExecutionTrigger("W\x46\x32\x5fCRE\x41\x54\x49\x4f\x4e");if(!$context->isAvailable()){break;}$gtfpogfmp="e\x6e\x74\x69t\x79\x44\x61\x74\x61";$wf->setContext(${$wwheuivbjc});if($wf->checkCondition(${$gtfpogfmp})){$wf->start();}}}}}if(${${"\x47\x4c\x4fB\x41L\x53"}["\x6d\x69\x6f\x6b\x64j\x64\x6dd\x66\x75"]}=="v\x74\x69\x67\x65\x72\x2eent\x69ty.af\x74e\x72\x73\x61\x76e"){$obmqbokjajz="\x63\x6f\x6ete\x78t";${$obmqbokjajz}=VTEntity::getForId($entityData->focus->id,$entityData->getModuleName());${"\x47L\x4f\x42\x41L\x53"}["u\x62\x6e\x69n\x62\x75n\x62"]="wf";${"GL\x4f\x42A\x4cS"}["j\x65\x66\x6cjf"]="c\x6f\x6ete\x78t";Queue::updateDynamicDate(${${"G\x4c\x4f\x42A\x4c\x53"}["\x6a\x65f\x6cj\x66"]});${${"GLO\x42A\x4c\x53"}["q\x79i\x72ws\x62mm\x75"]}=$wfManager->GetWorkflows($entityData->getModuleName(),array(Workflow\Main::ON_FIRST_SAVE,Workflow\Main::ON_EVERY_SAVE));${${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x71\x77\x76\x6du\x66v\x65\x7a"]}=$entityData->isNew();foreach(${${"\x47\x4c\x4f\x42\x41\x4c\x53"}["q\x79i\x72\x77\x73\x62mmu"]} as${${"G\x4c\x4fB\x41\x4c\x53"}["\x75\x62\x6e\x69\x6e\x62un\x62"]}){$uhytlcpqip="c\x6f\x6e\x74e\x78\x74";if(!$wf->checkExecuteCondition(${$uhytlcpqip})){continue;}$wf->setExecutionTrigger(${${"G\x4c\x4f\x42\x41L\x53"}["q\x77\x76\x6d\x75\x66\x76\x65\x7a"]}?"WF2\x5fCREA\x54\x49O\x4e":"WF\x32\x5f\x45\x56ERY\x5f\x53A\x56E");Workflow2::log($entityData->focus->id,$wf->getId(),0,"\x46\x6f\x75\x6ed\x20\x57\x46");$fbdjnio="is\x4e\x65\x77";if(PHP_SAPI==="\x63li"){echo"St\x61\x72\x74 \x6ff \x57ork\x66lo\x77\x20".$wf->getId()."\n";}${${"G\x4cOB\x41\x4c\x53"}["\x6cc\x6e\x69\x7am"]}=VTEntity::getForId($entityData->focus->id,$entityData->getModuleName());$context->setIsNew(${$fbdjnio});if(!$context->isAvailable()){break;}$wf->setContext(${${"G\x4cO\x42\x41\x4c\x53"}["\x6c\x63n\x69\x7am"]});if($wf->checkCondition(${${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x7a\x6c\x74\x6fn\x70\x63"]})){$wf->start();if($wf->getSuccessRedirection()!==false){header("Lo\x63\x61\x74i\x6f\x6e:".$wf->getSuccessRedirection());exit();}}}}if(${${"\x47\x4c\x4fB\x41\x4cS"}["\x74\x67rr\x6d\x62vg"]}=="\x76\x74ig\x65r.en\x74\x69ty.\x62\x65f\x6fr\x65\x64\x65let\x65"){${${"\x47L\x4f\x42\x41\x4c\x53"}["q\x79\x69\x72\x77s\x62m\x6d\x75"]}=$wfManager->GetWorkflows($entityData->getModuleName(),array(Workflow\Main::BEFOREDELETE_START));foreach(${${"GL\x4f\x42\x41LS"}["\x71\x79\x69rw\x73\x62\x6d\x6d\x75"]} as${${"\x47LO\x42A\x4c\x53"}["m\x6fypxy\x69\x77"]}){if(!$wf->checkExecuteCondition(${${"\x47\x4cOB\x41\x4c\x53"}["\x6c\x63\x6e\x69\x7a\x6d"]})){continue;}$wf->setExecutionTrigger(Workflow\Main::BEFOREDELETE_START);Workflow2::log($entityData->focus->id,$wf->getId(),0,"\x46ound\x20W\x46");if(PHP_SAPI==="\x63li"){echo"St\x61r\x74 o\x66\x20\x57or\x6bflo\x77\x20".$wf->getId()."\n";}${${"G\x4c\x4f\x42\x41\x4c\x53"}["l\x63\x6e\x69\x7a\x6d"]}=VTEntity::getForId($entityData->focus->id,$entityData->getModuleName());$context->setIsNew(false);if(!$context->isAvailable()){break;}$wf->setContext(${${"\x47L\x4f\x42\x41L\x53"}["l\x63ni\x7a\x6d"]});if($wf->checkCondition(${${"\x47\x4c\x4f\x42A\x4c\x53"}["\x7a\x6c\x74\x6f\x6ep\x63"]})){$wf->start();if($wf->getSuccessRedirection()!==false){Workflow2::error_handler(E_NONBREAK_ERROR,"\x52\x65dir\x65c\x74\x69\x6f\x6e\x73\x20d\x6f \x6e\x6ft\x20wor\x6b \x6fn\x20\"b\x65\x66o\x72\x65 dele\x74e\"\x20\x74\x72\x69g\x67\x65re\x64\x20\x57o\x72\x6bf\x6co\x77\x73.");}}}}if(isset(${$snkisgyf})){$_REQUEST["t\x61b\x6ce\x62\x6c\x6f\x63ks"]=${${"G\x4cOBAL\x53"}["\x75\x6a\x6e\x75\x74vf"]};}Workflow2::${${"\x47\x4cO\x42\x41LS"}["i\x68\x6fxvz\x6cni\x71"]}=false;}}
?>